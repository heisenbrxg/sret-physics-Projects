<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rydberg Blockade Visualization</title>
    <style>
        body {
            background-color: #0b200d;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        h1 {
            margin-top: 20px;
        }

        canvas {
            background-color: #101a33;
            display: block;
            margin: 20px auto;
            border-radius: 10px;
        }

        .info {
            width: 80%;
            margin: 10px auto;
            font-size: 16px;
            color: #cdd5e0;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        label {
            font-size: 14px;
        }

        input[type=range] {
            width: 100px;
        }

        button {
            background-color: #2c7df0;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background-color: #5198f8;
        }

        .counts {
            margin-top: 10px;
            font-size: 16px;
            color: #cdd5e0;
        }

        .mode {
            margin-top: 5px;
            font-size: 14px;
            color: #99b6ff;
        }
    </style>
</head>

<body>
    <h1>Rydberg Blockade Simulation</h1>
    <p class="info">Click an atom to excite it (manual mode) or switch to auto mode to see dynamic excitations under the
        Rydberg blockade effect.</p>

    <div class="controls">
          <label>Atoms: <span id="atomCountLabel">12</span>
                <input id="atomCount" type="range" min="4" max="30" value="12">
              </label>
          <label>Spacing: <span id="spacingLabel">60</span> px
                <input id="spacing" type="range" min="40" max="100" value="60">
              </label>
          <button id="resetBtn">Reset</button>
          <button id="autoBtn">Auto Mode</button>
          <button id="manualBtn" disabled>Manual Mode</button>
    </div>

    <canvas id="canvas" width="800" height="400"></canvas>
    <div class="counts">Excited Atoms: <span id="excitedCount">0</span> | Ground Atoms: <span id="groundCount">0</span>
    </div>
    <div class="mode" id="modeLabel">Mode: Manual</div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const resetBtn = document.getElementById('resetBtn');
        const autoBtn = document.getElementById('autoBtn');
        const manualBtn = document.getElementById('manualBtn');
        const modeLabel = document.getElementById('modeLabel');

        const atomCountInput = document.getElementById('atomCount');
        const spacingInput = document.getElementById('spacing');
        const atomCountLabel = document.getElementById('atomCountLabel');
        const spacingLabel = document.getElementById('spacingLabel');
        const excitedCountDisplay = document.getElementById('excitedCount');
        const groundCountDisplay = document.getElementById('groundCount');

        let numAtoms = parseInt(atomCountInput.value);
        let spacing = parseInt(spacingInput.value);
        const blockadeRadius = 100;
        let atoms = [];
        let autoMode = false;
        let autoInterval = null;

        function createAtoms() {
            atoms = [];
            const startX = (canvas.width - (numAtoms - 1) * spacing) / 2;
            for (let i = 0; i < numAtoms; i++) {
                atoms.push({ x: startX + i * spacing, y: canvas.height / 2, excited: false });
            }
        }

        function drawAtoms() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            atoms.forEach(atom => {
                if (atom.excited) {
                    ctx.beginPath();
                    ctx.arc(atom.x, atom.y, blockadeRadius, 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }

                ctx.beginPath();
                ctx.arc(atom.x, atom.y, 15, 0, Math.PI * 2);
                ctx.fillStyle = atom.excited ? '#ff6961' : '#9aa9b6';
                ctx.shadowColor = atom.excited ? '#ff6961' : 'transparent';
                ctx.shadowBlur = atom.excited ? 15 : 0;
                ctx.fill();
                ctx.shadowBlur = 0;
            });
            updateCounts();
        }

        function distance(a, b) {
            return Math.sqrt((a.x - b.x) ** 2 + (a.y - b.y) ** 2);
        }

        function canExcite(clickedAtom) {
            return !atoms.some(atom => atom.excited && distance(atom, clickedAtom) < blockadeRadius);
        }

        function updateCounts() {
            const excited = atoms.filter(a => a.excited).length;
            const ground = numAtoms - excited;
            excitedCountDisplay.textContent = excited;
            groundCountDisplay.textContent = ground;
        }

        canvas.addEventListener('click', e => {
            if (autoMode) return; // Disable clicks in auto mode
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            atoms.forEach(atom => {
                if (Math.hypot(atom.x - x, atom.y - y) < 20) {
                    if (atom.excited) {
                        atom.excited = false;
                    } else if (canExcite(atom)) {
                        atom.excited = true;
                    }
                }
            });
            drawAtoms();
        });

        resetBtn.addEventListener('click', () => {
            atoms.forEach(a => a.excited = false);
            drawAtoms();
        });

        atomCountInput.addEventListener('input', () => {
            numAtoms = parseInt(atomCountInput.value);
            atomCountLabel.textContent = numAtoms;
            createAtoms();
            drawAtoms();
        });

        spacingInput.addEventListener('input', () => {
            spacing = parseInt(spacingInput.value);
            spacingLabel.textContent = spacing;
            createAtoms();
            drawAtoms();
        });

        autoBtn.addEventListener('click', () => {
            if (autoMode) return;
            autoMode = true;
            modeLabel.textContent = 'Mode: Auto';
            autoBtn.disabled = true;
            manualBtn.disabled = false;

            autoInterval = setInterval(() => {
                const randomAtom = atoms[Math.floor(Math.random() * atoms.length)];
                if (randomAtom.excited) {
                    randomAtom.excited = false;
                } else if (canExcite(randomAtom)) {
                    randomAtom.excited = true;
                }
                drawAtoms();
            }, 600);
        });

        manualBtn.addEventListener('click', () => {
            if (!autoMode) return;
            autoMode = false;
            modeLabel.textContent = 'Mode: Manual';
            manualBtn.disabled = true;
            autoBtn.disabled = false;
            clearInterval(autoInterval);
        });

        createAtoms();
        drawAtoms();
    </script>
</body>

</html>